{% extends 'admin_base.html' %}
{% block content %}
  {% load form_filters %}
  {% load custom_filters %}
  <!DOCTYPE html>
  <html>
    <head>
      <title>Add New Store Item</title>
      <style>
        .form-container {
          background-color: #f9f9f9;
          padding: 20px;
        }
        
        .form-group {
          margin-bottom: 15px;
        }
        
        .form-group label {
          display: block;
          margin-bottom: 5px;
        }
        
        .form-actions {
          margin-top: 20px;
          text-align: right;
        }
        
        .btn {
          margin-right: 10px;
        }
      </style>
    </head>
    <body>
      <div class="main-content">
        <h1>Add New Store Item</h1>
        <div class="form-container">
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ store_item_form.as_p }}

            {{ variation_formset.management_form }}
            {% for variation_form in variation_formset %}
              {{ variation_form.as_p }}

              <!-- Use the choices_formset passed from the view -->
              {% with choices_formset=choices_formsets|get_item:forloop.counter0 %}
                {{ choices_formset.management_form }}
                {% for choice_form in choices_formset %}
                  {{ choice_form.as_p }}
                {% endfor %}
              {% endwith %}
            {% endfor %}

            <button type="submit">Save</button>
          </form>
        </div>
      </div>
    </body>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.add-choice').forEach((button) => {
          button.addEventListener('click', function () {
            const variationId = button.dataset.variationId
            const choiceFormset = document.querySelectorAll('div')[variationId].querySelector('.choice-formset') // Adjust this selector based on your HTML structure
      
            // Clone the first choice form
            const newChoiceForm = choiceFormset.children[1].cloneNode(true) // Assuming the first form is the template form
            newChoiceForm.querySelectorAll('input').forEach((input) => {
              input.value = '' // Clear the values for the new form
            })
      
            choiceFormset.appendChild(newChoiceForm)
          })
        })
      })
    </script>
  </html>
{% endblock %}
